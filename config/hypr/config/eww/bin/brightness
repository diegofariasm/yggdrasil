#!/usr/bin/env bash

if ! command -v brightnessctl &>/dev/null; then
	echo "brightnessctl command not found. Please install brightnessctl."
	exit
fi

function get() {
	max_brightness=$(brightnessctl max)
	current_brightness=$(brightnessctl get)

	if [[ -z "$max_brightness" || -z "$current_brightness" ]]; then
		echo "Error: failed to get brightness levels."
		exit
	fi

	last_percentage=-1

	while true; do
		# Get the current percentage
		percentage=$((current_brightness * 100 / max_brightness))

		# Output the percentage if it has changed
		if [[ "$percentage" -ne "$last_percentage" ]]; then
			printf "%d\n" "$percentage"
			last_percentage=$percentage
		fi

		# Sleep for 1 second before checking again
		sleep 1

		# Update the current brightness level in case it has changed
		current_brightness=$(brightnessctl get)
	done
}
if [[ $1 == 'get' ]]; then get; fi
