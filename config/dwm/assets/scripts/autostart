#!/usr/bin/env cached-nix-shell
#! nix-shell -p ruby -i "ruby -S" --quiet


require "~/.config/dwm/assets/scripts/src/environment.rb"
require "~/.config/dwm/assets/scripts/src/theme_changer.rb"

def check_theme(theme_dir, theme_files)
  has_valid_theme = true
  for theme_file in theme_files
    if not File.exists?("#{theme_dir}/#{theme_file}")
      has_valid_theme = false
    end
  end

  # Initialize the theme
  if (!has_valid_theme)
    puts "Invalid or unitialized theme; Initializing with gruvbox theme."
       ThemeChanger::change_theme( "everblush", Environment::THEME_DIR, Environment::DWM_DIR, Environment::ROFI_DIR, Environment::LUASTATUS_DIR, Environment::WALLPAPER_DIR, Environment::XRESOURCES_FILE
  )
  end
end

def load_theme(theme_dir, wallpaper_dir, xresources_file )
    # Load xresources
    system(
        "xrdb -merge #{xresources_file}"
    )
    # Reload theme in dwm
    system(
        "dwmc xrdb"
    ) 
    # Load wallpaper
    system(
        "#{wallpaper_dir}/fehbg"
    )

end

# Check for theming themes
check_theme(
  Environment::THEME_DIR,
  [ 
     "theme", 
     "theme.lua", 
     "theme.rasi" 
  ]

)

load_theme(
    Environment::THEME_DIR,
    Environment::WALLPAPER_DIR,
    Environment::XRESOURCES_FILE
)

